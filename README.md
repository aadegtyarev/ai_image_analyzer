# ai_image_analyzer

Python-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å –ø–æ–º–æ—â—å—é OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö vision-–º–æ–¥–µ–ª–µ–π.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- –æ–¥–Ω—É –∫–∞—Ä—Ç–∏–Ω–∫—É ‚Üí –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä—è–¥–æ–º —Å —Ñ–∞–π–ª–æ–º
- –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–¥–æ 10) ‚Üí —Ä–µ—Å–∞–π–∑ ‚Üí –∫–æ–ª–ª–∞–∂ ‚Üí –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
- —Ä–µ–∂–∏–º `--per-image` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- —Ç–µ–∫—Å—Ç–æ–≤—É—é –Ω–∞–¥—Å—Ç—Ä–æ–π–∫—É –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∏ (`-t`)
- —á–∏—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `.env` —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ CLI
- —Ä–∞–±–æ—Ç—É –∫–∞–∫ CLI-—É—Ç–∏–ª–∏—Ç–∞ –∏ –∫–∞–∫ –º–æ–¥—É–ª—å —Å JSON-API (–¥–ª—è Telegram-–±–æ—Ç–∞ –∏ –¥—Ä.)

---

## ‚öô –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–¢—Ä–µ–±—É–µ—Ç—Å—è **Python 3.9+**.

```bash
git clone <–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd <–ø–∞–ø–∫–∞_–ø—Ä–æ–µ–∫—Ç–∞>
````

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `requirements.txt`:

```text
openai>=1.54.0
Pillow>=11.0.0
python-dotenv>=1.0.1
```

---

## üß© –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ä—è–¥–æ–º —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º:

```bash
cp .env.example .env
```

–ü—Ä–∏–º–µ—Ä:

```env
OPENAI_API_KEY=your_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini
OPENAI_TIMEOUT=60
OPENAI_MAX_TOKENS=1024

IMAGE_MAX_SIZE=1024
IMAGE_QUALITY=85

COLLAGE_MAX_SIZE=2048
COLLAGE_QUALITY=85

PROMPT_FILE=prompts/art_analysis.txt
```

* `OPENAI_BASE_URL` ‚Äî –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏/—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã.
* –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `.env` –º–æ–∂–Ω–æ **–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑ CLI** –æ–¥–Ω–æ–∏–º—ë–Ω–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏:

  * `--OPENAI_MODEL`, `--OPENAI_TIMEOUT`, `--IMAGE_MAX_SIZE` –∏ —Ç.–¥.

* `OPENAI_MAX_TOKENS` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Ç–æ–∫–µ–Ω–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å (–ø–∞—Ä–∞–º–µ—Ç—Ä `max_tokens`).
* `OPENAI_BALANCE_THRESHOLD` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π –ø–æ—Ä–æ–≥ –±–∞–ª–∞–Ω—Å–∞ (–≤ –≤–∞–ª—é—Ç–µ —Å–µ—Ä–≤–∏—Å–∞). –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (`--check-balance`) –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å –º–µ–Ω—å—à–µ –ø–æ—Ä–æ–≥–∞, —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
* –ü–æ–ª—è `usage` (prompt_tokens/completion_tokens/total_tokens/total_cost) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. `total_cost` –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ 3 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π. –í CLI –≤—ã–≤–æ–¥–∏—Ç—Å—è `USAGE:` —Å —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω `-q`).

---

## üñº CLI-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–û–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

```bash
python ai_image_analyzer.py [OPTIONS] [images...]
```

–ì–¥–µ `images` ‚Äî –ø—É—Ç–∏ –∏–ª–∏ –º–∞—Å–∫–∏ (`"images/*.jpg"`).

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ü–∏–∏

* `-p, --PROMPT_FILE` ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–∞–π–ª –ø—Ä–æ–º—Ç–∞ (`PROMPT_FILE` –∏–∑ `.env`).
* `-t, --text` ‚Äî —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞–∫ `user` (PROMPT_FILE –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è).
* `--per-image` ‚Äî –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º (–±–µ–∑ –∫–æ–ª–ª–∞–∂–∞, –±–µ–∑ group-—Ñ–∞–π–ª–∞).
* `--check-balance` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ –≤—ã–≤–µ—Å—Ç–∏ JSON.
* `-q, --quiet` ‚Äî —Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º (–º–∏–Ω–∏–º—É–º –ª–æ–≥–æ–≤, –ø–æ–¥–∞–≤–ª—è–µ—Ç –≤—ã–≤–æ–¥ USAGE).

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–µ—Ä–µ–∑ CLI:

```text
--OPENAI_API_KEY, -k
--OPENAI_BASE_URL, -u
--OPENAI_MODEL, -m
--OPENAI_TIMEOUT, -T
--OPENAI_MAX_TOKENS, -M
--IMAGE_MAX_SIZE, -s
--IMAGE_QUALITY, -Q
--COLLAGE_MAX_SIZE, -S
--COLLAGE_QUALITY, -G
--PROMPT_FILE, -p
```

### 1Ô∏è‚É£ –û–¥–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞

–°–æ–∑–¥–∞—ë—Ç `photo_analyse.md` —Ä—è–¥–æ–º —Å —Ñ–∞–π–ª–æ–º:

```bash
python ai_image_analyzer.py images/photo.jpg
```

### 2Ô∏è‚É£ –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–¥–æ 10, –∫–æ–ª–ª–∞–∂)

–°–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–ª–ª–∞–∂ –∏ –æ–¥–∏–Ω –æ–±—â–∏–π —Ñ–∞–π–ª `group_YYYYMMDD_HHMMSS_analyse.txt`:

```bash
python ai_image_analyzer.py "images/*.jpg"
```

### 3Ô∏è‚É£ –†–µ–∂–∏–º `--per-image` (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ –∫–∞–∂–¥—É—é)

–ö–∞–∂–¥–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí `*_analyse.md`:

```bash
python ai_image_analyzer.py --per-image "images/*.jpg"
```

### 4Ô∏è‚É£ –ö–∞—Ä—Ç–∏–Ω–∫–∞ + —Ç–µ–∫—Å—Ç (PROMPT_FILE –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

–û—Ç–≤–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å, —Ñ–∞–π–ª—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è:

```bash
python ai_image_analyzer.py images/photo.jpg -t "–†–∞–∑–±–µ—Ä–∏ –∫–∞–¥—Ä –∫–∞–∫ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫"
```

### 5Ô∏è‚É£ –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç

–ë–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:

```bash
python ai_image_analyzer.py -t "–ü—Ä–µ–¥–ª–æ–∂–∏ –∏–¥–µ—é —Ñ–æ—Ç–æ—Å–µ—Ä–∏–∏ –æ –∑–∏–º–Ω–µ–π –º–µ–ª–∞–Ω—Ö–æ–ª–∏–∏"
```

---

## üìÇ –ü—Ä–æ–º–ø—Ç—ã

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–º–ø—Ç—ã –ª–µ–∂–∞—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `prompts/`:

* `PROMPT_FILE` —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º—Ç–æ–º.

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```text
prompts/
  art_analysis.txt
  series_idea.txt
  mentor_simple.txt
```

---

## üìù –ó–∞–º–µ—á–∞–Ω–∏—è

* –ú–∞–∫—Å–∏–º—É–º **10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.
* –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—Å–∞–π–∑—è—Ç—Å—è –¥–æ `IMAGE_MAX_SIZE` –ø–æ –¥–ª–∏–Ω–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.
* –ö–æ–ª–ª–∞–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Å–µ—Ç–∫—É (N√óN, N√óM).
* –í CLI –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–≤–æ—è OpenAI-—Å–µ—Å—Å–∏—è.

üìå –°–º. `CHANGELOG.md` –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## üêû –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

- `DEBUG=1` ‚Äî –æ–±—â–∏–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ (–∫–æ—Ä–æ—Ç–∫–∏–µ snippet'—ã system/user prompt –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è).
- `IMAGE_DEBUG=1` ‚Äî –ø–µ—á–∞—Ç–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º (`[IMAGE_DEBUG] image #...`).

- `DEBUG=1` ‚Äî –æ–±—â–∏–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ (–∫–æ—Ä–æ—Ç–∫–∏–µ snippet'—ã system/user prompt –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è). –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ `DEBUG` —Ç–∞–∫–∂–µ –ø–µ—á–∞—Ç–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–º—Ç–æ–≤ –¥–ª—è –∞–ª—å–±–æ–º–æ–≤ (`[MEDIA_DEBUG] set media context ...` / `[MEDIA_DEBUG] expired media context ...`).
- `IMAGE_DEBUG=1` ‚Äî –ø–µ—á–∞—Ç–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º (`[IMAGE_DEBUG] image #...`).

–ü—Ä–∏–º–µ—Ä:

```bash
DEBUG=1 IMAGE_DEBUG=1 python bot.py
```

Docker (basic):

```bash
docker compose up --build -d
```

```
::contentReference[oaicite:1]{index=1}
```
